<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:head>
        <title>#{profileViewBean.showUsername()}</title>
        <h:outputStylesheet library="css" name="styles.css" />
        <h:outputStylesheet library="css" name="uploadStyle.css" />
        <h:outputScript library='js' name='styleFuncs.js'/>
        <link href="https://fonts.googleapis.com/css?family=Courgette" rel="stylesheet"/>
        <h:outputScript library='js' name='gallery.js'/>
        <h:outputScript library='js' name='funcs.js'/>
    </h:head>
    
    <h:body id="gbody">
        
        
        <!--menu-->
        
        <h:form class='main-menu'>
            <p:growl id="msgs" showDetail="true" />
            <p:menubar class='main-menu'>
                <p:menuitem>
                    <h:link outcome="index.xhtml?faces-redirect=true">
                        <h:graphicImage library="images" name="logo.png" height="30" width='30'/>
                    </h:link>
                </p:menuitem>
                <p:menuitem value="           " disabled="true"/>
                <p:menuitem value="All posts" url="allPosts.xhtml?faces-redirect=true"/>
                <p:menuitem value="     |      " disabled="true"/>
                <p:menuitem value="Events" url="#"/>
                <p:menuitem value="     |      " disabled="true"/>
                <p:menuitem value="View" onclick="changeView(); return false;"/>
                <p:menuitem value="     |      " disabled="true"/>
                <p:menuitem value="Home" action="#{searchBean.goHome()}"/>
                <p:menuitem value="     |      " disabled="true"/>
                <p:menuitem value="+" onclick="#{profileViewBean.f()} showWindow('create-post-window');"/>
                <p:menuitem value="     |      " disabled="true"/>
                <p:menuitem value="Quit" url="index?faces-redirect=true"/>
                <f:facet name='options'>
                    <h:panelGrid id="countryTable" columns="2" cellpadding="0">                                  
                        <p:autoComplete emptyMessage="no users found" placeholder="Search" id="countryList" value="#{searchBean.username}" completeMethod="#{searchBean.userList()}">
                            <p:ajax event="itemSelect" listener="#{searchBean.onItemSelect}" update="msgs" />
                        </p:autoComplete>          
                        <p:panel style="width: 30px !important; opacity: 0;"/>
                    </h:panelGrid>
                </f:facet>
            </p:menubar>
        </h:form>
        
        <p:panel style="position: relative; height: 40px; width: 100%;"/>
        
        
        <!--bio-->
        
        <p:panel id='bioPanel'>
            
            <h:panelGroup id="avatar-pg"><p:graphicImage
                id='avatar'
                url="images/avatars/#{profileViewBean.showAvatar()}"
                style="width:100px; height:100px; -webkit-clip-path: circle(50%); float: left; margin-right: 20px;"   
                onclick="#{profileViewBean.f()} showWindow('change-avatar-window');"
            /></h:panelGroup>
            
            <p:panelGrid columns="2" style="width: 500px; height: 100px; font-size: 10pt;">      
                                         
                <h:outputLabel value="Id: " style="color: grey;"/>
                <h:outputLabel value="@#{profileViewBean.showUsername()}" />
                
                <h:outputLabel value="Name: " style="color: grey;"/>
                <h:outputLabel value="#{profileViewBean.showName()}" />
                
                <h:outputLabel value="Location: " style="color: grey;"/>
                <h:outputLabel value="#{profileViewBean.showLocation()}" />
                
                <h:outputLabel value="Bio: " style="color: grey;"/>
                <h:outputLabel value="#{profileViewBean.showBio()}" escape="false" />
 
            </p:panelGrid>              
            
            <h:form style="position: absolute; width: 300px; height: 50px; right: 200px; top: 40px; font-size: 8pt;">
                <p:panel id="followers-panel">
                    <p:panelGrid columns="2" style="width: 300px;">
                        <p:commandButton style="background-color: white; border: 0; font-size: 8pt; #{profileViewBean.followable()}" id="follow-button" value="#{profileViewBean.followState()}" action="#{profileViewBean.followUnfollow()}" update="followers-label, @this"/>
                        <p:outputLabel id="followers-label" style="color: grey; font-size: 8pt;" value="Followers: #{profileViewBean.followersCount()} | Follows: #{profileViewBean.followingsCount()}"/>
                    </p:panelGrid>
                </p:panel>
            </h:form>   
            
        </p:panel>
        
        
        <!--gallery type 1-->
        
        <center>        
            <h:panelGroup styleClass="imagebox" id="photo-gallery" style="display: block;">  
                <h:form>
                <h:panelGrid columns="3">
                    
                    <c:forEach items="#{profileViewBean.currentUserPhotoPosts}" var="postItem">
                        <p:commandLink action="#{profileViewBean.setCurrentImage(postItem.id)}" update=":smallWindow" oncomplete="showWindow('smallWindow');">
                            <h:graphicImage
                            class="thumbnail"                        
                            value="images/#{postItem.src}"                           
                            ><div class="thumbnail-overlay"/></h:graphicImage>
                        </p:commandLink>
                    </c:forEach>
                    
                </h:panelGrid>
                </h:form>
            </h:panelGroup>        
        </center>
        
        
        <!--gallery type 2-->        
        
        <center>        
            <h:panelGroup styleClass="imagebox" id="photo-wall" style="display: none;">  
                <h:form>
                <h:panelGrid columns="1">
                    
                    <c:forEach items="#{profileViewBean.currentUserPhotoPosts}" var="postItem">
                        
                        <p:panel style="height: 550px;" class="post-wall-panel">
                            <p:commandLink action="#{profileViewBean.setCurrentImage(postItem.id)}" update=":smallWindow" oncomplete="showWindow('smallWindow');">
                                <h:graphicImage
                                class="thumbnail-large"                        
                                value="images/#{postItem.src}"                           
                                />
                            </p:commandLink>
                        </p:panel>       
                        
                    </c:forEach>
                    
                </h:panelGrid>
                </h:form>
            </h:panelGroup>        
        </center>
        
        
        <!--post viewing-->
        
        <p:panelGrid columns="2" id="smallWindow" style="padding: 0; border: 0;" >
            
            <h:panelGroup id="image-pg" style="background-color: whitesmoke;">
                <h:graphicImage id="changing-image" value="images/#{profileViewBean.currSrc}"/>
                <h:form id="navigate-image-form" style="border: 0; position: fixed; ">
                    <p:panelGrid columns="2" id="dgFSGS" style="padding: 0; margin-left: auto; margin-right: auto; border: 0; top: 0; bottom: 0; margin-bottom: auto; margin-top: auto;" >
                        <p:commandButton id="prev-button" style="#{profileViewBean.prevImageAvailable()}" value="" action="#{profileViewBean.prevImage()}" update=":smallWindow" oncomplete="showWindow('smallWindow');"/>
                        <p:commandButton id="next-button" style="#{profileViewBean.nextImageAvailable()}" value="" action="#{profileViewBean.nextImage()}" update=":smallWindow" oncomplete="showWindow('smallWindow');"/>
                    </p:panelGrid>
                </h:form>
            </h:panelGroup>
            
            <p:panel id="commentsPanelID" style="height: 400px; width: 300px; margin: 0; padding: 0; padding-left: 10px; padding-right: 10px;">
                <h:form id="commentsFormID" style="height: 200px !important;">
                    
                    <p:panelGrid columns="2" style="height: 50px; max-width: 200px; margin: 0; padding: 0; margin-bottom: 20px;">
                        <h:outputText style="max-height: 50px !important; max-width: 200px; font: 10pt grey;" styleClass="word-wrap-text" rendered="#{profileViewBean.renderComments}" value="#{profileViewBean.currentPostText()}"/>
                    </p:panelGrid>
                    
                    <h:panelGroup id="tablePG" style="height: 220px;">
                        <p:dataTable rendered="#{profileViewBean.renderComments}" id="commentDataTableID" var="comment" value="#{profileViewBean.currentPostComments}" scrollable="true" scrollHeight="220">
                            <p:column>
                                <h:outputText style='font: 10pt grey;' value="#{comment.authorName}: "/>
                                <h:outputText value="#{comment.text}" rendered="#{profileViewBean.renderComments}"/>
                            </p:column>
                        </p:dataTable>
                    </h:panelGroup>
                    
                    <p:panelGrid columns="2" style="width: 250px;" rendered="#{profileViewBean.renderComments}">
                        <p:commandButton style="background-color: white; border: 0; font-size: 10pt;" id="like-button" value="#{profileViewBean.likeState()}" action="#{profileViewBean.addLike()}" update="like-comment-label, @this"/>
                        <p:outputLabel id="like-comment-label" style="color: grey; font-size: 10pt;" value="Likes: #{profileViewBean.likesCount()} | Comments: #{profileViewBean.commentsCount()}"/>
                    </p:panelGrid>
                    
                    <p:panelGrid columns="2" style="width: 250px; height: 50px; padding: 0; margin: 10px; margin-right: 10px;">
                        <p:inputTextarea value="#{profileViewBean.text}" style="width: 200px; height: 40px;"/>
                        <p:commandButton style="background-color: white; border: 0; font-size: 10pt; margin: 10px;" value="add" action="#{profileViewBean.createComment()}" update="commentDataTableID" oncomplete="showWindow('smallWindow');"/>
                    </p:panelGrid>
                    
                </h:form>
            </p:panel>  
            
        </p:panelGrid>
        
        
        <!--creating post-->        
        
        <p:panel id="create-post-window">
            <center>
                <h:form enctype="multipart/form-data" class="upload-form" id="upload-form">   
                    <p:fileUpload
                        id="fileUpload"
                        mode="advanced"
                        fileUploadListener="#{createPostBean.upload}"
                        sizeLimit="1000000"
                        allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
                        previewWidth="0"
                        dragDropSupport="true"
                        update=":panpan"
                        oncomplete="changeUploadState(1); return false;"
                    />    
                </h:form>
            </center>
            
            <p:panel id='panpan'>
                <center>
                    <h:form id='crop-form'>
                        
                        <p:panelGrid columns="1">
                            <p:graphicImage url="images/#{createPostBean.tempFilename}" style="width: 300px; height: 200px;"/>
                            <h:outputLabel value="Post description"/>
                            <p:inputTextarea id="post-text-input" value="#{createPostBean.postDescription}"/>                        
                        </p:panelGrid>
                        
                        <p:panelGrid columns="2" style="height: 30px;">
                            <p:commandButton value="Create" action="#{createPostBean.submit()}" update=":photo-gallery" oncomplete="hideWindow('create-post-window'); changeUploadState(0);"/>
                            <p:commandButton value="Cancel" onclick="changeUploadState(0); hideWindow('create-post-window'); return false;"/>
                        </p:panelGrid>  
                        
                    </h:form>
                </center>
            </p:panel>  
            
        </p:panel>
        
        
        <!--avatar changing-->
        
        <p:panel id="change-avatar-window">
            <center>
                <h:form enctype="multipart/form-data" class="upload-form" id="upload-form-avatar">   
                    <p:fileUpload
                        id="fileUpload-avatar"
                        mode="advanced"
                        fileUploadListener="#{createPostBean.uploadAvatar}"
                        sizeLimit="1000000"
                        allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
                        previewWidth="100"
                        dragDropSupport="true"
                        oncomplete="hideWindow('change-avatar-window');"
                        update=':avatar-pg, :avatar'
                    />                        
                </h:form>
            </center>            
        </p:panel>
        
        
        <!--other-->
        
        <div id="smallWindow-mask" class="mask" onclick="hideWindow('smallWindow'); return false;" />
        <div id="create-post-window-mask" class="mask" onclick="hideWindow('create-post-window'); changeUploadState(0); return false;" />
        <div id="change-avatar-window-mask" class="mask" onclick="hideWindow('change-avatar-window'); #{createPostBean.toReload()}" />

        <p:panel class="footer">
            <h:outputLabel value="ShareMoments (c) 2019"  style="color: grey; font-size: 8pt;"/><br/>
        </p:panel> 
        
    </h:body>
</html>